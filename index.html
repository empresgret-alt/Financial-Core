<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINANCIAL HUB | CLON PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        /* Estilos específicos para scrollbars y utilidades */
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(59, 130, 246, 0.2); }
        .nav-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="sticky top-0 z-50 bg-[#0f172a]/90 backdrop-blur border-b border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-chart-line text-blue-500 text-2xl"></i>
                    <span class="font-bold text-xl tracking-tight">FINANCIAL<span class="text-blue-500">HUB</span></span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <button onclick="router('mercado')" id="btn-mercado" class="nav-item hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors">Mercado</button>
                        <button onclick="router('scanner')" id="btn-scanner" class="nav-item hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors">Scanner Sheets</button>
                        <button onclick="router('analisis')" id="btn-analisis" class="nav-item hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors">Informes (Looker)</button>
                        <button onclick="router('cartera')" id="btn-cartera" class="nav-item text-blue-400 bg-blue-500/10 hover:bg-blue-500/20 px-3 py-2 rounded-md text-sm font-bold transition-colors border border-blue-500/30">
                            <i class="fa-solid fa-lock mr-2"></i>Área Privada
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="tradingview-widget-container border-b border-slate-800 bg-[#0f172a]">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
        {
        "symbols": [{"proName": "FOREXCOM:SPX500","title": "S&P 500"},{"proName": "FOREXCOM:NSXUSD","title": "US 100"},{"proName": "FX_IDC:EURUSD","title": "EUR/USD"},{"proName": "BITSTAMP:BTCUSD","title": "Bitcoin"}],
        "showSymbolLogo": true, "colorTheme": "dark", "isTransparent": true, "displayMode": "adaptive", "locale": "es"
        }
        </script>
    </div>

    <main id="app-container" class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        </main>

    <footer class="bg-slate-900 border-t border-slate-800 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-slate-500 text-sm">
            <p>&copy; 2026 Financial Hub Clone. Datos proporcionados por TradingView & Google Finance.</p>
        </div>
    </footer>

    <script>
        // --- 1. CONFIGURACIÓN FIREBASE (¡PEGA TUS CLAVES AQUÍ!) ---
        const firebaseConfig = {
            apiKey: "TU_API_KEY_DE_FIREBASE",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            projectId: "TU_PROYECTO_ID",
            storageBucket: "TU_PROYECTO.appspot.com",
            messagingSenderId: "NUMEROS",
            appId: "TU_APP_ID"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- 2. CONFIGURACIÓN GOOGLE SHEET (¡PEGA TU CSV AQUÍ!) ---
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/TU_ID_DE_GOOGLE_SHEET/export?format=csv';

        // --- 3. RUTAS Y VISTAS ---
        const app = document.getElementById('app-container');

        // Vista: MERCADO (Home)
        const viewMercado = `
            <div class="fade-in space-y-6">
                <div class="text-center mb-10">
                    <h1 class="text-4xl font-bold text-white mb-2">Visión de Mercado</h1>
                    <p class="text-slate-400">Datos en tiempo real y análisis técnico</p>
                </div>
                <div class="h-[600px] w-full glass-panel rounded-xl overflow-hidden p-1">
                    <div class="tradingview-widget-container" style="height:100%;width:100%">
                        <div class="tradingview-widget-container__widget" style="height:calc(100% - 32px);width:100%"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                        {
                        "colorTheme": "dark", "dateRange": "12M", "showChart": true, "locale": "es", "largeChartUrl": "", "isTransparent": true, "showSymbolLogo": true, "showFloatingTooltip": false, "width": "100%", "height": "100%", "tabs": [{"title": "Índices", "symbols": [{"s": "FOREXCOM:SPX500"},{"s": "FOREXCOM:NSXUSD"},{"s": "FOREXCOM:DJI"},{"s": "INDEX:NKY"},{"s": "INDEX:DEU40"}]}]
                        }
                        <\/script>
                    </div>
                </div>
            </div>
        `;

        // Vista: SCANNER (Google Sheets Data)
        const viewScanner = `
            <div class="fade-in space-y-6">
                <div class="flex justify-between items-end">
                    <h2 class="text-2xl font-bold text-white"><span class="text-green-400">Live</span> Scanner IBEX35</h2>
                    <button onclick="loadSheetData()" class="text-xs bg-slate-800 hover:bg-slate-700 px-3 py-1 rounded border border-slate-700">Actualizar</button>
                </div>
                <div class="glass-panel rounded-xl overflow-hidden">
                    <table class="min-w-full text-left text-sm">
                        <thead class="bg-slate-800 text-slate-400 uppercase font-medium">
                            <tr>
                                <th class="px-6 py-4">Ticker</th>
                                <th class="px-6 py-4">Precio</th>
                                <th class="px-6 py-4">Estado</th>
                            </tr>
                        </thead>
                        <tbody id="sheet-data-body" class="divide-y divide-slate-700/50 text-slate-300">
                            <tr><td colspan="3" class="px-6 py-4 text-center">Cargando datos de Google Sheets...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        `;

        // Vista: ANALISIS (Looker Studio)
        const viewAnalisis = `
            <div class="fade-in h-screen flex flex-col">
                <h2 class="text-2xl font-bold text-white mb-4">Informes Financieros</h2>
                <iframe 
                    src="https://lookerstudio.google.com/embed/reporting/TU_REPORT_ID/page/TU_PAGE_ID" 
                    frameborder="0" 
                    style="border:0" 
                    allowfullscreen 
                    class="w-full h-full rounded-xl border border-slate-800 bg-slate-900">
                </iframe>
            </div>
        `;

        // Vista: CARTERA (Área Privada con Firebase)
        const viewCarteraLogin = `
            <div class="fade-in flex items-center justify-center h-[50vh]">
                <div class="glass-panel p-8 rounded-2xl max-w-md w-full text-center space-y-6">
                    <i class="fa-solid fa-vault text-4xl text-blue-500"></i>
                    <h2 class="text-2xl font-bold text-white">Acceso Inversores</h2>
                    <p class="text-slate-400 text-sm">Inicia sesión para ver y gestionar tu portfolio privado.</p>
                    <button onclick="loginWithGoogle()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center gap-2">
                        <i class="fa-brands fa-google"></i> Acceder con Google
                    </button>
                </div>
            </div>
        `;

        const viewCarteraDashboard = (user) => `
            <div class="fade-in space-y-6">
                <div class="flex justify-between items-center bg-blue-900/20 p-6 rounded-xl border border-blue-500/30">
                    <div>
                        <h2 class="text-xl font-bold text-white">Hola, ${user.displayName}</h2>
                        <p class="text-blue-400 text-xs mt-1">ID: ${user.uid}</p>
                    </div>
                    <button onclick="logout()" class="text-sm text-red-400 hover:text-red-300">Cerrar Sesión</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="font-bold text-white mb-4">Añadir Posición</h3>
                        <div class="space-y-3">
                            <input type="text" id="assetName" placeholder="Ej: Apple (AAPL)" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white focus:border-blue-500 outline-none">
                            <input type="number" id="assetValue" placeholder="Valor (€)" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white focus:border-blue-500 outline-none">
                            <button onclick="addAsset()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-2 rounded font-medium">Guardar Activo</button>
                        </div>
                    </div>

                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="font-bold text-white mb-4">Mi Portfolio</h3>
                        <ul id="portfolio-list" class="space-y-2 text-sm text-slate-300">
                            <li>Cargando cartera...</li>
                        </ul>
                    </div>
                </div>
            </div>
        `;

        // --- 4. FUNCIONES LÓGICAS ---

        // Router simple
        function router(route) {
            // Actualizar estilo botones nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('nav-active', 'text-blue-400'));
            const btn = document.getElementById(`btn-${route}`);
            if(btn) btn.classList.add('nav-active', 'text-blue-400');

            if (route === 'mercado') {
                app.innerHTML = viewMercado;
                // Re-ejecutar scripts de TradingView insertados dinámicamente
                refreshScripts(); 
            } else if (route === 'scanner') {
                app.innerHTML = viewScanner;
                loadSheetData();
            } else if (route === 'analisis') {
                app.innerHTML = viewAnalisis;
            } else if (route === 'cartera') {
                checkAuth();
            }
        }

        // Hack para que los widgets de TradingView carguen al cambiar de vista
        function refreshScripts() {
            const scripts = app.querySelectorAll('script');
            scripts.forEach(oldScript => {
                const newScript = document.createElement('script');
                Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                oldScript.parentNode.replaceChild(newScript, oldScript);
            });
        }

        // Lógica Google Sheets
        async function loadSheetData() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                const data = await response.text();
                const rows = data.split('\n').slice(1); // Ignorar cabecera si la hay
                let html = '';
                rows.forEach(row => {
                    const cols = row.split(',');
                    if(cols.length >= 2) {
                        html += `
                        <tr class="hover:bg-slate-800/50 transition">
                            <td class="px-6 py-4 font-bold text-white">${cols[0]}</td>
                            <td class="px-6 py-4 font-mono">${cols[1]}</td>
                            <td class="px-6 py-4"><span class="bg-blue-500/10 text-blue-400 px-2 py-1 rounded text-xs">Actualizado</span></td>
                        </tr>`;
                    }
                });
                document.getElementById('sheet-data-body').innerHTML = html;
            } catch (error) {
                console.error('Error sheets:', error);
                document.getElementById('sheet-data-body').innerHTML = '<tr><td colspan="3" class="px-6 py-4 text-red-400">Error cargando datos. Verifica la URL CSV.</td></tr>';
            }
        }

        // Lógica Auth Firebase
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(error => alert(error.message));
        }

        function logout() {
            auth.signOut();
        }

        function checkAuth() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    app.innerHTML = viewCarteraDashboard(user);
                    loadPortfolio(user.uid);
                } else {
                    app.innerHTML = viewCarteraLogin;
                }
            });
        }

        // Lógica Firestore (Base de Datos)
        function addAsset() {
            const user = auth.currentUser;
            const name = document.getElementById('assetName').value;
            const value = document.getElementById('assetValue').value;

            if(user && name && value) {
                db.collection('users').doc(user.uid).collection('portfolio').add({
                    asset: name,
                    value: parseFloat(value),
                    date: new Date()
                }).then(() => {
                    document.getElementById('assetName').value = '';
                    document.getElementById('assetValue').value = '';
                    loadPortfolio(user.uid);
                });
            }
        }

        function loadPortfolio(uid) {
            db.collection('users').doc(uid).collection('portfolio').orderBy('date', 'desc').get().then(snap => {
                let html = '';
                let total = 0;
                snap.forEach(doc => {
                    const data = doc.data();
                    total += data.value;
                    html += `
                        <li class="flex justify-between items-center bg-slate-800 p-3 rounded border-l-4 border-blue-500">
                            <span>${data.asset}</span>
                            <span class="font-bold text-white">${data.value} €</span>
                        </li>`;
                });
                if(html === '') html = '<li class="text-slate-500 italic">No tienes activos aún.</li>';
                
                // Añadir total al principio
                html = `<li class="text-xl font-bold text-white mb-4 border-b border-slate-700 pb-2">Total Patrimonio: <span class="text-emerald-400">${total} €</span></li>` + html;
                
                document.getElementById('portfolio-list').innerHTML = html;
            });
        }

        // Iniciar App en 'Mercado'
        router('mercado');

    </script>
</body>
</html>
